{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "verify-email-form-clerk",
  "type": "registry:component",
  "title": "Verify Email Form (Clerk)",
  "author": "@mrzachnugent",
  "description": "A form for verifying an email address with an OTP sent via email with Clerk integration.",
  "dependencies": [
    "@clerk/clerk-expo"
  ],
  "registryDependencies": [
    "https://reactnativereusables.com/r/new-york/button.json",
    "https://reactnativereusables.com/r/new-york/card.json",
    "https://reactnativereusables.com/r/new-york/input.json",
    "https://reactnativereusables.com/r/new-york/label.json",
    "https://reactnativereusables.com/r/new-york/text.json"
  ],
  "files": [
    {
      "path": "./node_modules/@rnr/registry/src/blocks/clerk/verify-email-form.tsx",
      "content": "import { Button } from '@/registry/new-york/components/ui/button';\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardHeader,\n  CardTitle,\n} from '@/registry/new-york/components/ui/card';\nimport { Input } from '@/registry/new-york/components/ui/input';\nimport { Label } from '@/registry/new-york/components/ui/label';\nimport { Text } from '@/registry/new-york/components/ui/text';\nimport { useSignUp } from '@clerk/clerk-expo';\nimport * as React from 'react';\nimport { type TextStyle, View } from 'react-native';\n\nconst RESEND_CODE_INTERVAL_SECONDS = 30;\n\nconst TABULAR_NUMBERS_STYLE: TextStyle = { fontVariant: ['tabular-nums'] };\n\nexport function VerifyEmailForm() {\n  const { signUp, setActive, isLoaded } = useSignUp();\n  const [code, setCode] = React.useState('');\n  const [error, setError] = React.useState('');\n  const { countdown, restartCountdown } = useCountdown(RESEND_CODE_INTERVAL_SECONDS);\n\n  async function onSubmit() {\n    if (!isLoaded) return;\n\n    try {\n      // Use the code the user provided to attempt verification\n      const signUpAttempt = await signUp.attemptEmailAddressVerification({\n        code,\n      });\n\n      // If verification was completed, set the session to active\n      // and redirect the user\n      if (signUpAttempt.status === 'complete') {\n        await setActive({ session: signUpAttempt.createdSessionId });\n        // TODO: Redirect authenticated users to your protected screen\n        return;\n      }\n      // TODO: Handle other statuses\n      // If the status is not complete, check why. User may need to\n      // complete further steps.\n      console.error(JSON.stringify(signUpAttempt, null, 2));\n    } catch (err) {\n      // See https://go.clerk.com/mRUDrIe for more info on error handling\n      if (err instanceof Error) {\n        setError(err.message);\n        return;\n      }\n      console.error(JSON.stringify(err, null, 2));\n    }\n  }\n\n  async function onResendCode() {\n    if (!isLoaded) return;\n\n    try {\n      await signUp.prepareEmailAddressVerification({ strategy: 'email_code' });\n      restartCountdown();\n    } catch (err) {\n      // See https://go.clerk.com/mRUDrIe for more info on error handling\n      if (err instanceof Error) {\n        setError(err.message);\n        return;\n      }\n      console.error(JSON.stringify(err, null, 2));\n    }\n  }\n\n  return (\n    <View className=\"gap-6\">\n      <Card className=\"border-border/0 sm:border-border shadow-none sm:shadow-sm sm:shadow-black/5\">\n        <CardHeader>\n          <CardTitle className=\"text-center text-xl sm:text-left\">Verify your email</CardTitle>\n          <CardDescription className=\"text-center sm:text-left\">\n            Enter the verification code sent to m@example.com\n          </CardDescription>\n        </CardHeader>\n        <CardContent className=\"gap-6\">\n          <View className=\"gap-6\">\n            <View className=\"gap-1.5\">\n              <Label htmlFor=\"code\">Verification code</Label>\n              <Input\n                id=\"code\"\n                autoCapitalize=\"none\"\n                onChangeText={setCode}\n                returnKeyType=\"send\"\n                keyboardType=\"numeric\"\n                autoComplete=\"sms-otp\"\n                textContentType=\"oneTimeCode\"\n                onSubmitEditing={onSubmit}\n              />\n              {!error ? null : (\n                <Text className=\"text-destructive text-sm font-medium\">{error}</Text>\n              )}\n              <Button variant=\"link\" size=\"sm\" disabled={countdown > 0} onPress={onResendCode}>\n                <Text className=\"text-center text-xs\">\n                  Didn&apos;t receive the code? Resend{' '}\n                  {countdown > 0 ? (\n                    <Text className=\"text-xs\" style={TABULAR_NUMBERS_STYLE}>\n                      ({countdown})\n                    </Text>\n                  ) : null}\n                </Text>\n              </Button>\n            </View>\n            <View className=\"gap-3\">\n              <Button className=\"w-full\" onPress={onSubmit}>\n                <Text>Continue</Text>\n              </Button>\n              <Button\n                variant=\"link\"\n                className=\"mx-auto\"\n                onPress={() => {\n                  // TODO: Navigate to sign up screen\n                }}>\n                <Text>Cancel</Text>\n              </Button>\n            </View>\n          </View>\n        </CardContent>\n      </Card>\n    </View>\n  );\n}\n\nfunction useCountdown(seconds = 30) {\n  const [countdown, setCountdown] = React.useState(seconds);\n  const intervalRef = React.useRef<ReturnType<typeof setInterval> | null>(null);\n\n  const startCountdown = React.useCallback(() => {\n    setCountdown(seconds);\n\n    if (intervalRef.current) {\n      clearInterval(intervalRef.current);\n    }\n\n    intervalRef.current = setInterval(() => {\n      setCountdown((prev) => {\n        if (prev <= 1) {\n          if (intervalRef.current) {\n            clearInterval(intervalRef.current);\n            intervalRef.current = null;\n          }\n          return 0;\n        }\n        return prev - 1;\n      });\n    }, 1000);\n  }, [seconds]);\n\n  React.useEffect(() => {\n    startCountdown();\n\n    return () => {\n      if (intervalRef.current) {\n        clearInterval(intervalRef.current);\n      }\n    };\n  }, [startCountdown]);\n\n  return { countdown, restartCountdown: startCountdown };\n}\n",
      "type": "registry:component"
    }
  ]
}